generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model alimentos {
  id                          Int     @id @default(autoincrement())
  categoria                   String? @db.VarChar(255)
  alimento_normalizado        String? @unique(map: "ix_alimentos_alimento_normalizado") @db.VarChar(255)
  alimentos                   String? @db.VarChar(255)
  alimento                    String? @db.VarChar(255)
  energia_kcal_100g           Float?
  proteina_g_100g             Float?
  carboidrato_g_100g          Float?
  lipidios_g_100g             Float?
  fibra_g_100g                Float?
  ac_graxos_saturados_g       Float?
  ac_graxos_monoinsaturados_g Float?
  ac_graxos_poliinsaturados_g Float?
  colesterol_mg_100g          Float?
  sodio_mg_100g               Float?
  potassio_mg_100g            Float?
  calcio_mg_100g              Float?
  ferro_mg_100g               Float?
  magnesio_mg_100g            Float?
  unidades                    Float?
  un_medida_caseira           String? @db.VarChar(255)
  peso_aproximado_g           Float?
  dieta                       String? @db.VarChar(255)
  refeicao                    String? @db.VarChar(255)
  status                      String? @db.VarChar(255)

  @@index([categoria], map: "ix_alimentos_categoria")
  @@index([id], map: "ix_alimentos_id")
}

model alimentos_salvos {
  id                      Int              @id @default(autoincrement())
  refeicao_id             Int
  nome                    String           @db.VarChar(255)
  quantidade_estimada_g   Int?
  categoria_nutricional   String?          @db.VarChar(100)
  confianca               String?          @db.VarChar(50)
  calorias_estimadas      Int?
  medida_caseira_sugerida String?          @db.VarChar(100)
  refeicoes_salvas        refeicoes_salvas @relation(fields: [refeicao_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([id], map: "ix_alimentos_salvos_id")
}

model dados_usuarios {
  id                 Int       @id @default(autoincrement())
  usuario_id         Int
  altura_cm          Decimal?  @db.Decimal
  peso_kg            Decimal?  @db.Decimal
  idade              Int?
  sexo               String?   @db.VarChar
  nivel_atividade    String?   @db.VarChar
  dieta_preferida    String?   @db.VarChar
  objetivo           String?   @db.VarChar
  kcal_meta          Float?
  proteina_g_meta    Float?
  carboidrato_g_meta Float?
  lipidios_g_meta    Float?
  fibras_g_meta      Float?
  role               String    @db.VarChar
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @db.Timestamptz(6)
  usuarios           usuarios  @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([id], map: "ix_dados_usuarios_id")
}

model historico_usuarios {
  id                 Int       @id @default(autoincrement())
  usuario_id         Int
  altura_cm          Decimal?  @db.Decimal
  peso_kg            Decimal?  @db.Decimal
  idade              Int?
  sexo               String?   @db.VarChar
  nivel_atividade    String?   @db.VarChar
  dieta_preferida    String?   @db.VarChar
  objetivo           String?   @db.VarChar
  kcal_meta          Decimal?  @db.Decimal
  proteina_g_meta    Decimal?  @db.Decimal
  carboidrato_g_meta Decimal?  @db.Decimal
  lipidios_g_meta    Decimal?  @db.Decimal
  fibras_g_meta      Decimal?  @db.Decimal
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @db.Timestamptz(6)
  usuarios           usuarios  @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([id], map: "ix_historico_usuarios_id")
}

model refeicoes_salvas {
  id                   Int                @id @default(autoincrement())
  owner_id             Int
  status               refeicaostatus?
  analysis_result_json String?
  created_at           DateTime?          @db.Timestamp(6)
  updated_at           DateTime?          @db.Timestamp(6)
  imagem_url           String?            @db.VarChar(512)
  alimentos_salvos     alimentos_salvos[]
  usuarios             usuarios           @relation(fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([id], map: "ix_refeicoes_salvas_id")
}

model usuarios {
  id                 Int                  @id @default(autoincrement())
  nome               String               @db.VarChar
  apelido            String?              @db.VarChar
  email              String               @unique(map: "ix_usuarios_email") @db.VarChar
  senha_hash         String               @db.VarChar
  email_verificado   Boolean?
  is_active          Boolean?
  dados_usuarios     dados_usuarios[]
  historico_usuarios historico_usuarios[]
  refeicoes_salvas   refeicoes_salvas[]

  @@index([id], map: "ix_usuarios_id")
}

enum refeicaostatus {
  PENDING_ANALYSIS
  ANALYSIS_COMPLETE
  ANALYSIS_FAILED
}

model Consentimento {
  id          Int      @id @default(autoincrement())
  email       String
  termos      Boolean
  privacidade Boolean
  marketing   Boolean  @default(false)
  version     String
  ip          String?
  userAgent   String?
  timestamp   DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([email])
  @@map("consentimentos")
}

